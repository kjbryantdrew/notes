# 文本替换：替换部分字符串
### 保留匹配部分字符串
场景：在数据平台中使用impala-shell命令行接口导出的数据文件中，如果原始数据已经精确到了秒，那么导出的文件中会精确到毫秒级别，但是此会影响到下游系统入库。文件中的时间只需要保留到秒即可

```bash
# 匹配yyyy-mm-dd hh:mm:ss.000000000格式的时间戳
\d\{4}-\d\{2}-\d\{2} \d\{2}:\d\{2}:\d\{2}\.\d\{9}

# 替换
%s/\(\d\{4}-\d\{2}-\d\{2} \d\{2}:\d\{2}:\d\{2}\).\d\{9}/\1/g
# \( \) 转义括号，括号内的是需要匹配且保留的字符串；
# \d 整数，\{2}匹配两次
# \1表示保留第一个通过括号匹配到的字符串

# sed替换，sed和vim命令行略有不同
# [0-9]表示整数，\{2\}表示匹配两次
sed -i "s/\([0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\} [0-9]\{2\}:[0-9]\{2\}:[0-9]\{2\}\).[0-9]\{9\}/\1/g" /mnt/disk6/ods_data/20211031/ens_f_entry.unl;

# 在python中调用sed命令还需要注意花括号转义的问题
cmd='sed -i "s/\([0-9]\{{4\}}-[0-9]\{{2\}}-[0-9]\{{2\}} [0-9]\{{2\}}:[0-9]\{{2\}}:[0-9]\{{2\}}\).[0-9]\{{9\}}/\\1/g" {filename}'
```